Ярославский филиал Московского финансово-юридического университета
МФЮА
ПРАКТИЧЕСКАЯ РАБОТА №1
ПО ДИСЦИПЛИНЕ
“Операционные системы и среды”
Автор:
Студент группы 31ИПо8381
Корпачев Д.Д
Руководитель:
Фурмавнин С.А
Ярославль 2024



Вариант №1
Задание №2


Цель работы:
Создать скрипт, принимающий в качестве агрумента
строку, и создающий архив, включающий в себя все файлы из домашней
директории пользователя с расширением .txt. Имя итогового архива должно
состоять из переданного аргумента и отметки времени строка_час_минута_секунда.


Теоретические сведения:

Используемые команды в скрипте:
-z - используется для проверки на пустоту строки
date +"%Y %m %d_%H %M %S": Это команда date, которая выводит текущую дату и время в заданном формате: 	 
-r - флаг, указывающий на необходимость рекурсивного сжатия. При использовании -r zip будет включать в архив все подходящие файлы и папки, которые находятся внутри указанного каталога и его подкаталогов.
-eq сравнивает два числа на равенство 
if - условие если
then - тогда
elif - (else if), иначе если
else - иначе
fi - ключевое слово, которое используется для завершения условного оператора if
echo - вывод текста


Расчётно-графическая часть:

Разберём нашу задачу:

I Блок:
1. Нужно указать, что файл - это исполняемый скрипт bash
2. Далее нам нужно условие, что бы проверить, не ввёл ли пользователь пустую строку
2.2 Если условие истинно, то есть аргумент пуст, то должно быть выведено сообщение об ошибке
2.3 И, соответственно, если условие истинно, программа должна завершиться с кодом 1(код ошибки)
2.4 Блок условия завершается

II Блок:

1. Мы должны объявить переменную, куда будет записываться текущая дата и время в формате "год месяц день_час минута секунда"
2. Стоит создать имя архива, комбинируя имя архива с временной меткой и добавляя расширение .zip что бы собирать в .zip будущие файлы
3. Можем создать переменную, в которой будет содержаться путь к домашнему каталогу пользователя

III Блок:

1. Можем создать новый подшелл и попытаемся перейти в домашний каталог, если не получается - скрипт завершается с кодом ошибки 1
2. Стоит написать команду zip которая создает архив с именем, указанным в archive_name, и добавляет в него все файлы с расширением .txt из текущего каталога. Если команда zip завершится с ошибкой, скрипт также завершится с кодом 1.
3. Закрываем подшелл

IV Блок:

1. Так как мы собрались в блоке 3 использовать подшелл - стоит проверить с помощью if, с каким кодом zip завершился, если там 0 - команда отработала корректно
2. Если архив был успешно создан, выводим сообщение об этом
3. Нужно прописать блок else, если предыдущая команда завершилась с ошибкой
3.1 Выводим сообщение об ошибке в стандартный поток ошибок
3.2 Завершаем выполнение скрипта с кодом 1
4. Завершаем блок if

V Блок:

1. Завершаем выполнение скрипта с кодом 0


Синтез решения: 
#!/bin/bash

if [ -z "$1" ]; then
  echo "Ошибка: Необходимо указать строку для имени архива." >&2
  exit 1
fi

timestamp=$(date +"%Y %m %d_%H %M %S")
archive_name="${1}_${timestamp}.zip"
home_dir="$HOME"

(
  cd "$home_dir" || exit 1
  zip -r "$archive_name" *.txt || exit 1
)

if [ $? -eq 0 ]; then
    echo "Архив '$archive_name' успешно создан."
else
    echo "Ошибка при создании архива. Проверьте права доступа и наличие утилиты zip." >&2
    exit 1
fi

exit 0


Теперь, время для теста скрипта:
Я создал три файла с расширением .txt в своём домашнем каталоге и .zip файл корректно сохранил в себе все три файла



Вывод:
При выполнении данного задания я сталкивался с трудностями, как именно сохранять файлы, но нашёл решение спустя какое-то время поисков информации. Я получил небольшой опыт в написании скриптов для bash'a, оформлении информации по задуманному плану, разбивании задачи на блоки(подзадачи).


